-- DealFlow Initial Schema Migration
-- Generated by ChatGPT

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

CREATE DATABASE IF NOT EXISTS dealflow
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;
USE dealflow;

-- -----------------------------------------------------------------------------
-- Roles & Permissions
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS roles (
  id TINYINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50) NOT NULL UNIQUE,
  description VARCHAR(255) NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS role_permissions (
  role_id TINYINT UNSIGNED NOT NULL,
  permission VARCHAR(100) NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (role_id, permission),
  CONSTRAINT fk_role_permissions_role
    FOREIGN KEY (role_id) REFERENCES roles(id)
    ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- Organizations & Contacts
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS organizations (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  type ENUM('client', 'vendor') NOT NULL,
  website VARCHAR(255) NULL,
  country_code CHAR(2) NULL,
  timezone VARCHAR(64) NULL,
  notes TEXT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  UNIQUE KEY uk_organizations_name_type (name, type),
  KEY idx_organizations_type (type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS users (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  org_id BIGINT UNSIGNED NULL,
  email VARCHAR(255) NOT NULL,
  name VARCHAR(150) NOT NULL,
  password_hash CHAR(60) NOT NULL,
  role_id TINYINT UNSIGNED NOT NULL,
  active TINYINT(1) NOT NULL DEFAULT 1,
  last_login_at DATETIME NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  UNIQUE KEY uk_users_email (email),
  KEY idx_users_role_active (role_id, active),
  CONSTRAINT fk_users_role
    FOREIGN KEY (role_id) REFERENCES roles(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_users_org
    FOREIGN KEY (org_id) REFERENCES organizations(id)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS contacts (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  org_id BIGINT UNSIGNED NOT NULL,
  name VARCHAR(150) NOT NULL,
  email VARCHAR(255) NULL,
  phone VARCHAR(50) NULL,
  title VARCHAR(150) NULL,
  notes TEXT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  KEY idx_contacts_org_id (org_id),
  CONSTRAINT fk_contacts_org
    FOREIGN KEY (org_id) REFERENCES organizations(id)
    ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- Reference Data
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS technologies (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(150) NOT NULL,
  category VARCHAR(100) NULL,
  description TEXT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uk_technologies_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS currencies (
  code CHAR(3) PRIMARY KEY,
  symbol VARCHAR(8) NOT NULL,
  name VARCHAR(100) NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS price_list (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  role VARCHAR(100) NOT NULL,
  level VARCHAR(100) NULL,
  tech_id BIGINT UNSIGNED NULL,
  currency CHAR(3) NOT NULL,
  rate_hr DECIMAL(18,4) NULL,
  rate_day DECIMAL(18,4) NULL,
  rate_mo DECIMAL(18,4) NULL,
  valid_from DATE NOT NULL,
  valid_to DATE NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_price_list_tech
    FOREIGN KEY (tech_id) REFERENCES technologies(id)
    ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT fk_price_list_currency
    FOREIGN KEY (currency) REFERENCES currencies(code)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  KEY idx_price_list_role_level (role, level),
  KEY idx_price_list_currency (currency)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- Vendors
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS vendors (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  org_id BIGINT UNSIGNED NOT NULL,
  agreement_terms TEXT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  CONSTRAINT fk_vendors_org
    FOREIGN KEY (org_id) REFERENCES organizations(id)
    ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS vendor_resources (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  vendor_id BIGINT UNSIGNED NOT NULL,
  role VARCHAR(100) NOT NULL,
  level VARCHAR(100) NULL,
  tech_id BIGINT UNSIGNED NULL,
  cost_rate_hr DECIMAL(18,4) NULL,
  cost_rate_day DECIMAL(18,4) NULL,
  cost_rate_mo DECIMAL(18,4) NULL,
  availability JSON NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  KEY idx_vendor_resources_vendor (vendor_id),
  KEY idx_vendor_resources_tech (tech_id),
  CONSTRAINT fk_vendor_resources_vendor
    FOREIGN KEY (vendor_id) REFERENCES vendors(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_vendor_resources_tech
    FOREIGN KEY (tech_id) REFERENCES technologies(id)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- RFx & Estimates
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS rfx (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  org_id BIGINT UNSIGNED NOT NULL,
  type ENUM('rfi', 'rfp', 'rfq') NOT NULL,
  title VARCHAR(255) NOT NULL,
  status ENUM('draft','open','submitted','won','lost','cancelled','archived') NOT NULL DEFAULT 'draft',
  due_at DATETIME NULL,
  owner_user_id BIGINT UNSIGNED NOT NULL,
  notes TEXT NULL,
  attachments_url JSON NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  KEY idx_rfx_org_status (org_id, status),
  KEY idx_rfx_owner (owner_user_id),
  KEY idx_rfx_due_at (due_at),
  CONSTRAINT fk_rfx_org
    FOREIGN KEY (org_id) REFERENCES organizations(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_rfx_owner
    FOREIGN KEY (owner_user_id) REFERENCES users(id)
    ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS estimates (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  rfx_id BIGINT UNSIGNED NOT NULL,
  model ENUM('tm','fixed') NOT NULL,
  currency CHAR(3) NOT NULL,
  subtotal DECIMAL(18,4) NOT NULL DEFAULT 0,
  vendor_cost DECIMAL(18,4) NOT NULL DEFAULT 0,
  margin_amount DECIMAL(18,4) NOT NULL DEFAULT 0,
  margin_pct DECIMAL(7,4) NULL,
  risk_buffer DECIMAL(18,4) NULL,
  mgmt_fee DECIMAL(18,4) NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  CONSTRAINT fk_estimates_rfx
    FOREIGN KEY (rfx_id) REFERENCES rfx(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_estimates_currency
    FOREIGN KEY (currency) REFERENCES currencies(code)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  KEY idx_estimates_rfx (rfx_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS estimate_items (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  estimate_id BIGINT UNSIGNED NOT NULL,
  role VARCHAR(100) NOT NULL,
  level VARCHAR(100) NULL,
  tech_id BIGINT UNSIGNED NULL,
  qty_hours DECIMAL(18,2) NULL,
  qty_days DECIMAL(18,2) NULL,
  qty_months DECIMAL(18,2) NULL,
  unit_rate DECIMAL(18,4) NOT NULL DEFAULT 0,
  line_total DECIMAL(18,4) NOT NULL DEFAULT 0,
  vendor_id BIGINT UNSIGNED NULL,
  vendor_unit_cost DECIMAL(18,4) NULL,
  vendor_total_cost DECIMAL(18,4) NULL,
  notes TEXT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  KEY idx_estimate_items_estimate (estimate_id),
  KEY idx_estimate_items_vendor (vendor_id),
  CONSTRAINT fk_estimate_items_estimate
    FOREIGN KEY (estimate_id) REFERENCES estimates(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_estimate_items_vendor
    FOREIGN KEY (vendor_id) REFERENCES vendors(id)
    ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT fk_estimate_items_tech
    FOREIGN KEY (tech_id) REFERENCES technologies(id)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- Deals & Commissions
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS deals (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  rfx_id BIGINT UNSIGNED NOT NULL,
  client_id BIGINT UNSIGNED NOT NULL,
  status ENUM('negotiation','won','lost','on_hold') NOT NULL DEFAULT 'negotiation',
  signed_value DECIMAL(18,4) NULL,
  currency CHAR(3) NOT NULL,
  start_at DATE NULL,
  end_at DATE NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at DATETIME NULL,
  CONSTRAINT fk_deals_rfx
    FOREIGN KEY (rfx_id) REFERENCES rfx(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_deals_client
    FOREIGN KEY (client_id) REFERENCES organizations(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_deals_currency
    FOREIGN KEY (currency) REFERENCES currencies(code)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  KEY idx_deals_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS commissions (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  deal_id BIGINT UNSIGNED NOT NULL,
  type ENUM('sales','middleman','outreach') NOT NULL,
  actor_id BIGINT UNSIGNED NOT NULL,
  basis ENUM('revenue','margin') NULL,
  percent DECIMAL(6,4) NULL,
  fixed_amount DECIMAL(18,4) NULL,
  currency CHAR(3) NOT NULL,
  amount_calc DECIMAL(18,4) NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_commissions_deal
    FOREIGN KEY (deal_id) REFERENCES deals(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_commissions_actor
    FOREIGN KEY (actor_id) REFERENCES users(id)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_commissions_currency
    FOREIGN KEY (currency) REFERENCES currencies(code)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  KEY idx_commissions_deal (deal_id),
  KEY idx_commissions_actor (actor_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- FX Rates
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS fx_rates (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  base CHAR(3) NOT NULL,
  quote CHAR(3) NOT NULL,
  rate DECIMAL(18,8) NOT NULL,
  as_of DATE NOT NULL,
  source VARCHAR(50) NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uk_fx_rates_base_quote_date (base, quote, as_of),
  KEY idx_fx_rates_base_quote_asof (base, quote, as_of DESC),
  CONSTRAINT fk_fx_rates_base_currency
    FOREIGN KEY (base) REFERENCES currencies(code)
    ON DELETE RESTRICT ON UPDATE CASCADE,
  CONSTRAINT fk_fx_rates_quote_currency
    FOREIGN KEY (quote) REFERENCES currencies(code)
    ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- Audit & Settings
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS audit_log (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id BIGINT UNSIGNED NULL,
  entity VARCHAR(100) NOT NULL,
  entity_id BIGINT UNSIGNED NOT NULL,
  action ENUM('create','update','delete','login','logout','error') NOT NULL,
  at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  delta_json JSON NULL,
  ip_address VARCHAR(45) NULL,
  user_agent VARCHAR(255) NULL,
  KEY idx_audit_entity (entity, entity_id),
  KEY idx_audit_user_at (user_id, at),
  CONSTRAINT fk_audit_user
    FOREIGN KEY (user_id) REFERENCES users(id)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS app_settings (
  id TINYINT UNSIGNED PRIMARY KEY DEFAULT 1,
  smtp_json JSON NULL,
  integrations_json JSON NULL,
  branding_json JSON NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- -----------------------------------------------------------------------------
-- Auth Support Tables
-- -----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS refresh_tokens (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id BIGINT UNSIGNED NOT NULL,
  token_hash CHAR(64) NOT NULL,
  issued_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NOT NULL,
  rotated_at TIMESTAMP NULL,
  replaced_by BIGINT UNSIGNED NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  KEY idx_refresh_tokens_user (user_id),
  KEY idx_refresh_tokens_expires (expires_at),
  CONSTRAINT fk_refresh_tokens_user
    FOREIGN KEY (user_id) REFERENCES users(id)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_refresh_tokens_replaced
    FOREIGN KEY (replaced_by) REFERENCES refresh_tokens(id)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS token_blacklist (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  token_hash CHAR(64) NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  KEY idx_token_blacklist_hash (token_hash),
  KEY idx_token_blacklist_expires (expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

SET FOREIGN_KEY_CHECKS = 1;

-- -----------------------------------------------------------------------------
-- Seed Data
-- -----------------------------------------------------------------------------
INSERT INTO currencies (code, symbol, name) VALUES
  ('EUR', '€', 'Euro'),
  ('USD', '$', 'US Dollar'),
  ('VND', '₫', 'Vietnamese Dong'),
  ('GBP', '£', 'British Pound Sterling'),
  ('SGD', 'S$', 'Singapore Dollar'),
  ('HKD', 'HK$', 'Hong Kong Dollar'),
  ('AUD', 'A$', 'Australian Dollar')
ON DUPLICATE KEY UPDATE
  symbol = VALUES(symbol),
  name = VALUES(name);

INSERT INTO roles (id, name, description) VALUES
  (1, 'Admin', 'Full system access'),
  (2, 'Sales', 'Sales team access'),
  (3, 'Ops', 'Operations team access'),
  (4, 'Finance', 'Finance team access'),
  (5, 'Vendor_Manager', 'Vendor management access')
ON DUPLICATE KEY UPDATE
  name = VALUES(name),
  description = VALUES(description);

INSERT INTO role_permissions (role_id, permission) VALUES
  (1, '*'),
  (2, 'rfx.create'),
  (2, 'rfx.view_own'),
  (2, 'estimate.create'),
  (2, 'estimate.view'),
  (3, 'rfx.view_all'),
  (3, 'estimate.view'),
  (3, 'estimate.view_cost'),
  (3, 'estimate.view_margin'),
  (3, 'commission.view'),
  (4, 'estimate.view'),
  (4, 'estimate.view_cost'),
  (4, 'estimate.view_margin'),
  (4, 'commission.manage'),
  (4, 'deal.view_all'),
  (5, 'vendor.manage'),
  (5, 'vendor_resource.manage'),
  (5, 'estimate_item.view_vendor_cost')
ON DUPLICATE KEY UPDATE role_id = role_id;

INSERT INTO users (id, email, name, password_hash, role_id, active)
VALUES (1, 'admin@dealflow.com', 'System Admin', '$2y$12$f6P3nSm8fc0TpyVz5Xk97OaFYQ7qd6BpAvNCWRCHnkTs9n3LMKDKa', 1, 1)
ON DUPLICATE KEY UPDATE
  email = VALUES(email),
  name = VALUES(name),
  password_hash = VALUES(password_hash),
  role_id = VALUES(role_id),
  active = VALUES(active);

